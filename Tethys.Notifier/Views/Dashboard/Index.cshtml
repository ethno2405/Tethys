@model Tethys.Notifier.ViewModels.Dashboard.IndexViewModel

@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

@section scripts
{
    <script type="text/javascript" src="~/Scripts/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.signalR-2.1.1.js"></script>
    <script src="/signalr/js"></script>

    <script type="text/javascript">
        $(function () {
            var message = "@(Model.Message.Replace(Environment.NewLine, " "))";
            if (message) {
                alert(message);
            }
            
            var callNotifier = $.connection.callNotifierHub;

            $.connection.hub.start({ transport: ['webSockets', 'longPolling'] }).done(function () {
                $('.call-type-button').click(function () {
                    callNotifier.server.notify($(this).text().trim());
                });
            });

            callNotifier.client.callRecieved = function (callType) {
                alert(callType);
            };
        });
    </script>
}

@if (Model.IsLocalized)
{
    using (Html.BeginForm("Index", "Dashboard", FormMethod.Post))
    {
    <div class="btn-group-vertical calls">
        @foreach (var callType in Model.CallTypes)
        {
            <a href="#" class="pull-left call-type-button btn btn-default" data-isActive="@callType.IsActive">
                <div class="call-type-wrapper">
                    <div class="pull-left color-icon" style="background-color:@callType.Color"></div>
                    <span class="pull-left call-type-text">@callType.Name</span>
                </div>
            </a>
        }
    </div>
    }
}
else
{ 
    @Html.ActionLink("Localize", "Index", "Localization", null, new { @class = "btn btn-info btn-lg localization-circle-btn" })
}